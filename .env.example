# -----------------------------------------------------------------------------
# Core runtime
# -----------------------------------------------------------------------------
ENV=prod
TZ=Asia/Kolkata
LOG_LEVEL=INFO
LANG=C.UTF-8
PYTHONUNBUFFERED=1

# If no vertical is inferred, fall back to this.
FALLBACK_VERTICAL=entertainment

# Single source of truth for story deep links in shares/notifications
# (Frontend detail route base). Keep DEEP_LINK_BASE equal for back-compat.
SHARE_BASE_URL=https://app.nutshellnewsapp.com/#/s
DEEP_LINK_BASE=https://app.nutshellnewsapp.com/#/s


# -----------------------------------------------------------------------------
# Storage / queues
# -----------------------------------------------------------------------------
DATABASE_URL=postgresql+psycopg://postgres:postgres@db:5432/cinepulse  # (unused today)
REDIS_URL=redis://redis:6379/0
RQ_REDIS_URL=redis://redis:6379/0


# -----------------------------------------------------------------------------
# Feed storage / dedupe (sanitizer + api)
# -----------------------------------------------------------------------------
FEED_KEY=feed:items
SEEN_KEY=feed:seen_signatures
MAX_FEED_LEN=200

FEED_PUBSUB=feed:pub
FEED_STREAM=feed:stream
FEED_STREAM_MAXLEN=5000

SSE_HEARTBEAT_SEC=20


# -----------------------------------------------------------------------------
# Push notifications (off by default)
# -----------------------------------------------------------------------------
ENABLE_PUSH_NOTIFICATIONS=0
PUSH_ENABLED=0

PUSH_SET=push:tokens
PUSH_META=push:meta
PUSH_TOPIC_PREFIX=push:topic:
PUSH_DEFAULT_TOPIC=all

PUSH_MAX_TOKENS_PER_STORY=5000
PUSH_BODY_MAX_CHARS=180

FCM_SERVER_KEY=


# -----------------------------------------------------------------------------
# API service (FastAPI + gunicorn layer)
# -----------------------------------------------------------------------------
# Public API base actually used by the frontend
API_PUBLIC_BASE_URL=https://api.nutshellnewsapp.com

# CORS allowlist for browsers (comma-separated, no spaces)
CORS_ORIGINS=https://app.nutshellnewsapp.com,http://localhost:5173

# Optional service-to-service URL for internal calls
API_INTERNAL_BASE_URL=http://api:8000

# Optional renderer for share cards (unused today)
RENDERER_URL=http://renderer:8000


# -----------------------------------------------------------------------------
# API request limits / pagination
# -----------------------------------------------------------------------------
BATCH_SIZE=200
RL_FEED_PER_MIN=120
RL_SEARCH_PER_MIN=90
RL_STORY_PER_MIN=240


# -----------------------------------------------------------------------------
# Summarizer controls (apps/workers/summarizer.py)
# -----------------------------------------------------------------------------
SUMMARY_TARGET_WORDS=80
SUMMARY_MIN_WORDS=70
SUMMARY_MAX_WORDS=90
SUMMARY_PASSTHROUGH_MAX_WORDS=120
SUMMARY_PASSTHROUGH_MAX_CHARS=900


# -----------------------------------------------------------------------------
# Observability / error reporting
# -----------------------------------------------------------------------------
SENTRY_DSN_BACKEND=


# -----------------------------------------------------------------------------
# External APIs / keys
# -----------------------------------------------------------------------------
TMDB_API_KEY=
YOUTUBE_API_KEY=
OMDB_API_KEY=
ENABLE_TMDB_INGEST=true


# -----------------------------------------------------------------------------
# Scheduler / ingestion loop (apps/scheduler/main.py)
# -----------------------------------------------------------------------------
SOURCES_FILE=/app/infra/source.yml
USE_SOURCES_FILE=true

# Safe fallbacks if YAML is disabled/missing (keep noise-free)
# Comma-separated channel IDs:
YT_CHANNELS=UCq-Fj5jknLsUf-MWSy4_brA,UCI5q9xeOp2-1bV7xEtKgzA
# Format: URL|kind_hint
RSS_FEEDS=https://www.bollywoodhungama.com/rss/news.xml|news,https://www.indiatoday.in/rss/1206578|news,https://indianexpress.com/section/entertainment/feed/|news

POLL_INTERVAL_MIN=5
PUBLISHED_AFTER_HOURS=36
POLL_SPREAD_SEC=2.0
POLL_JITTER_SEC=10

YT_MAX_ITEMS=50
RSS_MAX_ITEMS=200

# Run one scheduler cycle and exit (useful for tests/CI)
ONE_SHOT=false

# Feature flags
ENABLE_YOUTUBE_INGEST=true
ENABLE_RSS_INGEST=true


# -----------------------------------------------------------------------------
# Webhooks service (apps/webhooks/main.py)
# -----------------------------------------------------------------------------
# If you donâ€™t expose webhooks publicly yet, leave this as a placeholder.
PUBLIC_BASE_URL=https://hooks.example.com
WEBHOOK_LEASE_SEC=86400
PUSH_HTTP_TIMEOUT=8.0
AUTO_SUBSCRIBE_ON_START=false
YT_PULL_WINDOW_HOURS=72
RSS_PULL_WINDOW_HOURS=48
WEBHOOK_SHARED_SECRET=
